<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>StreamNet Rebrands</title>
    <link rel="stylesheet" href="src/styles/main.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <div class="header">
      <!-- Left side with app title and version -->
      <div class="header-left">
        <div class="title-container">
          <h1>Rebrand Panel Tool</h1>
          <div id="versionBadge" class="version-badge">loading...</div>
        </div>
      </div>

      <!-- Right side with actions -->
      <div class="header-right">
        <!-- Connection status indicator -->
        <div class="connection-indicator-container">
          <span id="connectionIndicator" class="status-indicator"></span>
          <span id="connectionText">Checking connection...</span>
        </div>

        <!-- Settings button -->
        <button
          id="settingsBtn"
          class="header-button settings-button"
          title="Settings"
        >
          <span class="settings-icon">‚öô</span>
        </button>
      </div>
    </div>

    <!-- Update notification toast that appears below header -->
    <div id="updateStatus" class="update-toast"></div>

    <div class="container">
      <!-- Source Panel (Panels & Modules Selection) -->
      <div class="panel source-panel">
        <h2 class="panel-title">Panels & Modules</h2>

        <div class="panel-content">
          <!-- Panels Section -->
          <div class="selection-category">
            <h3 class="category-title">Select Panels</h3>

            <div class="panel-controls">
              <button id="selectAllPanels" class="select-all-button">
                Select All Panels
              </button>
              <button id="unselectAllPanels" class="unselect-all-button">
                Unselect All
              </button>
            </div>
            <div class="selection-items">
              <!-- Cockpit Panel -->
              <div
                class="selection-item"
                data-tooltip="Main control panel for Rebrands"
              >
                <input
                  type="checkbox"
                  id="cockpitPanel"
                  class="module-checkbox"
                  data-type="panel"
                  data-name="cockpitpanel"
                  data-source="cockpitpanel"
                />
                <span class="module-icon panel-icon">
                  <img
                    src="src/icons/rebrands.png"
                    alt="Cockpit Panel"
                    class="icon-image"
                  />
                </span>
                <label for="cockpitPanel" class="module-name"
                  >Cockpit Panel</label
                >
              </div>

              <!-- Support Panel -->
              <div
                class="selection-item"
                data-tooltip="Customer support interface"
              >
                <input
                  type="checkbox"
                  id="supportPanel"
                  class="module-checkbox"
                  data-type="panel"
                  data-name="support"
                  data-source="support"
                />
                <span class="module-icon panel-icon">
                  <img
                    src="src/icons/telegram.png"
                    alt="Support Panel"
                    class="icon-image"
                  />
                </span>
                <label for="supportPanel" class="module-name">Support</label>
              </div>

              <!-- MultiProxy Panel -->
              <div
                class="selection-item"
                data-tooltip="Multi-proxy configuration panel"
              >
                <input
                  type="checkbox"
                  id="multiProxyPanel"
                  class="module-checkbox"
                  data-type="panel"
                  data-name="multiproxy"
                  data-source="multiproxy"
                />
                <span class="module-icon panel-icon">
                  <img
                    src="src/icons/multi.png"
                    alt="MultiProxy Panel"
                    class="icon-image"
                  />
                </span>
                <label for="multiProxyPanel" class="module-name"
                  >MultiProxy</label
                >
              </div>

              <!-- WebViews Panel -->
              <div
                class="selection-item"
                data-tooltip="Web-based Android Views panel"
              >
                <input
                  type="checkbox"
                  id="webviewsPanel"
                  class="module-checkbox"
                  data-type="panel"
                  data-name="webviews"
                  data-source="webviews"
                />
                <span class="module-icon panel-icon">
                  <img
                    src="src/icons/android.png"
                    alt="WebViews Panel"
                    class="icon-image"
                  />
                </span>
                <label for="webviewsPanel" class="module-name">WebViews</label>
              </div>
            </div>
          </div>

          <!-- Modules Section -->
          <div class="selection-category">
            <h3 class="category-title">Select App Modules</h3>

            <div class="module-controls">
              <button id="selectAllModules" class="select-all-button">
                Select All Modules
              </button>
              <button id="unselectAllModules" class="unselect-all-button">
                Unselect All
              </button>
            </div>

            <!-- OTT Applications Subsection -->
            <div class="module-subsection">
              <h4 class="subsection-title">OTT Applications</h4>
              <div class="selection-items">
                <!-- XCIPTV Module -->
                <div
                  class="selection-item"
                  data-tooltip="IPTV client application"
                >
                  <input
                    type="checkbox"
                    id="xciptvModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="xciptv"
                  />
                  <span class="module-icon">
                    <img
                      src="src/icons/xciptv.png"
                      alt="XCIPTV"
                      class="icon-image"
                    />
                  </span>
                  <label for="xciptvModule" class="module-name">XCIPTV</label>
                </div>

                <!-- TiviMate Module -->
                <div class="selection-item" data-tooltip="Premium IPTV player">
                  <input
                    type="checkbox"
                    id="tiviMateModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="tivimate"
                  />
                  <span class="module-icon">
                    <img
                      src="src/icons/tivimate.png"
                      alt="TiviMate"
                      class="icon-image"
                    />
                  </span>
                  <label for="tiviMateModule" class="module-name"
                    >TiviMate</label
                  >
                </div>

                <!-- Smarters Pro Module -->
                <div
                  class="selection-item"
                  data-tooltip="IPTV Smarters Pro player"
                >
                  <input
                    type="checkbox"
                    id="smartersProModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="smarterspro"
                  />
                  <span class="module-icon">
                    <img
                      src="src/icons/smarters.png"
                      alt="Smarters Pro"
                      class="icon-image"
                    />
                  </span>
                  <label for="smartersProModule" class="module-name"
                    >Smarters Pro</label
                  >
                </div>

                <!-- IBO Module -->
                <div class="selection-item" data-tooltip="IBO Player for IPTV">
                  <input
                    type="checkbox"
                    id="iboModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="ibo"
                  />
                  <span class="module-icon">
                    <img
                      src="src/icons/ibosol.png"
                      alt="IBO"
                      class="icon-image"
                    />
                  </span>
                  <label for="iboModule" class="module-name">IBO</label>
                </div>

                <!-- Neutro Module -->
                <div class="selection-item" data-tooltip="Neutro streaming app">
                  <input
                    type="checkbox"
                    id="neutroModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="neutro"
                  />
                  <span class="module-icon">
                    <img
                      src="src/icons/neutro.png"
                      alt="Neutro"
                      class="icon-image"
                    />
                  </span>
                  <label for="neutroModule" class="module-name">Neutro</label>
                </div>

                <!-- Purple Neu Module -->
                <div
                  class="selection-item"
                  data-tooltip="Purple Neu streaming client"
                >
                  <input
                    type="checkbox"
                    id="neuModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="neu"
                  />
                  <span class="module-icon">
                    <img
                      src="src/icons/pneu.png"
                      alt="Purple Neu"
                      class="icon-image"
                    />
                  </span>
                  <label for="neuModule" class="module-name">Purple Neu</label>
                </div>

                <!-- Purple Easy Module -->
                <div
                  class="selection-item"
                  data-tooltip="Purple Easy streaming app"
                >
                  <input
                    type="checkbox"
                    id="easyModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="easy"
                  />
                  <span class="module-icon">
                    <img
                      src="src/icons/peasy.png"
                      alt="Purple Easy"
                      class="icon-image"
                    />
                  </span>
                  <label for="easyModule" class="module-name"
                    >Purple Easy</label
                  >
                </div>

                <!-- Sparkle Module -->
                <div class="selection-item" data-tooltip="Sparkle media player">
                  <input
                    type="checkbox"
                    id="sparkleModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="sparkle"
                  />
                  <span class="module-icon">
                    <img
                      src="src/icons/sparkle.png"
                      alt="Sparkle"
                      class="icon-image"
                    />
                  </span>
                  <label for="sparkleModule" class="module-name">Sparkle</label>
                </div>

                <!-- 1Stream Module -->
                <div class="selection-item" data-tooltip="1Stream media player">
                  <input
                    type="checkbox"
                    id="1streamModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="1stream"
                  />
                  <span class="module-icon">
                    <img
                      src="src/icons/1stream.png"
                      alt="1Stream"
                      class="icon-image"
                    />
                  </span>
                  <label for="1streamModule" class="module-name">1Stream</label>
                </div>

                <!-- 9Xtream Module -->
                <div
                  class="selection-item"
                  data-tooltip="9Xtream streaming app"
                >
                  <input
                    type="checkbox"
                    id="9xtreamModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="9xtream"
                  />
                  <span class="module-icon">
                    <img
                      src="src/icons/9xtream.png"
                      alt="9Xtream"
                      class="icon-image"
                    />
                  </span>
                  <label for="9xtreamModule" class="module-name">9Xtream</label>
                </div>
              </div>
            </div>

            <!-- VOD Applications Subsection -->
            <div class="module-subsection">
              <h4 class="subsection-title">VOD Applications</h4>
              <div class="selection-items">
                <!-- FlixVision Module -->
                <div
                  class="selection-item"
                  data-tooltip="Video-on-demand streaming app"
                >
                  <input
                    type="checkbox"
                    id="flixvisionModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="flixvision"
                  />
                  <span class="module-icon">
                    <img
                      src="src/icons/flixvision.png"
                      alt="FlixVision"
                      class="icon-image"
                    />
                  </span>
                  <label for="flixvisionModule" class="module-name"
                    >FlixVision</label
                  >
                </div>

                <!-- SmartTube Module -->
                <div
                  class="selection-item"
                  data-tooltip="Enhanced YouTube client"
                >
                  <input
                    type="checkbox"
                    id="smarttubeModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="smarttube"
                  />
                  <span class="module-icon">
                    <img
                      src="src/icons/smarttube.png"
                      alt="SmartTube"
                      class="icon-image"
                    />
                  </span>
                  <label for="smarttubeModule" class="module-name"
                    >SmartTube</label
                  >
                </div>

                <!-- Stremio Module -->
                <div
                  class="selection-item"
                  data-tooltip="Multi-source media center"
                >
                  <input
                    type="checkbox"
                    id="stremioModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="stremio"
                  />
                  <span class="module-icon">
                    <img
                      src="src/icons/stremio.png"
                      alt="Stremio"
                      class="icon-image"
                    />
                  </span>
                  <label for="stremioModule" class="module-name">Stremio</label>
                </div>
              </div>
            </div>

            <!-- VPN Applications Subsection -->
            <div class="module-subsection">
              <h4 class="subsection-title">VPN Applications</h4>
              <div class="selection-items">
                <!-- ORVPN Module -->
                <div
                  class="selection-item"
                  data-tooltip="Open-source VPN client"
                >
                  <input
                    type="checkbox"
                    id="orvpnModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="orvpn"
                  />
                  <span class="module-icon">
                    <img
                      src="src/icons/orvpn.png"
                      alt="ORVPN"
                      class="icon-image"
                    />
                  </span>
                  <label for="orvpnModule" class="module-name">ORVPN</label>
                </div>

                <!-- IPVanish Module -->
                <div class="selection-item" data-tooltip="IPVanish VPN service">
                  <input
                    type="checkbox"
                    id="ipvanishModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="ipvanish"
                  />
                  <span class="module-icon">
                    <img
                      src="src/icons/ipvanish.png"
                      alt="IPVanish"
                      class="icon-image"
                    />
                  </span>
                  <label for="ipvanishModule" class="module-name"
                    >IPVanish</label
                  >
                </div>

                <!-- PIA Module -->
                <div
                  class="selection-item"
                  data-tooltip="Private Internet Access VPN"
                >
                  <input
                    type="checkbox"
                    id="piaModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="pia"
                  />
                  <span class="module-icon">
                    <img src="src/icons/pia.png" alt="PIA" class="icon-image" />
                  </span>
                  <label for="piaModule" class="module-name">PIA</label>
                </div>
              </div>
            </div>

            <!-- STORE Applications Subsection -->
            <div class="module-subsection">
              <h4 class="subsection-title">STORE Applications</h4>
              <div class="selection-items">
                <!-- Downloader Module -->
                <div
                  class="selection-item"
                  data-tooltip="File download manager"
                >
                  <input
                    type="checkbox"
                    id="downloaderModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="downloader"
                  />
                  <span class="module-icon">
                    <img
                      src="src/icons/downloader.png"
                      alt="Downloader"
                      class="icon-image"
                    />
                  </span>
                  <label for="downloaderModule" class="module-name"
                    >Downloader</label
                  >
                </div>

                <!-- SH9 Store Module -->
                <div class="selection-item" data-tooltip="SH9 App Store">
                  <input
                    type="checkbox"
                    id="sh9storeModule"
                    class="module-checkbox"
                    data-type="module"
                    data-name="sh9store"
                  />
                  <span class="module-icon">
                    <img
                      src="src/icons/sh9.png"
                      alt="SH9 Store"
                      class="icon-image"
                    />
                  </span>
                  <label for="sh9storeModule" class="module-name"
                    >SH9 Store</label
                  >
                </div>
              </div>
            </div>

            <div class="selection-summary">
              <div id="selectedCount">0 items selected</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Destination Panel with Fixed Bottom Button -->
      <div class="panel destination-panel">
        <h2 class="panel-title">Domain & Panel Setup</h2>

        <!-- Scrollable content area -->
        <div class="destination-content">
          <!-- Create Domain Section -->
          <div class="destination-section">
            <label class="destination-label">Create New Domain</label>
            <button id="newDomainBtn" class="action-button full-width">
              <span class="button-icon">+</span> Create New Domain
            </button>
          </div>

          <!-- DNS Settings Section -->
          <div class="destination-section">
            <div class="dns-header">
              <label class="destination-label">
                Cloudflare DNS Setup
                <div class="toggle-switch">
                  <input type="checkbox" id="dnsToggle" class="toggle-input" />
                  <label for="dnsToggle" class="toggle-label"></label>
                </div>
              </label>
            </div>

            <div id="dnsForm" class="dns-form" style="display: none">
              <div class="form-field">
                <label class="field-label">Subdomain</label>
                <input
                  type="text"
                  id="subdomainInput"
                  class="text-input"
                  placeholder="e.g., exampleSubDomain"
                />
              </div>
              <div class="dns-info">
                Will create 6 DNS records for:<br />
                <span id="dnsPreview" class="dns-domain-preview"
                  >subdomain.streamnet.live</span
                >
              </div>
              <!-- New section for DNS records preview -->
              <div id="dnsRecordsPreviewContainer"></div>
            </div>
          </div>

          <!-- Domain Selection Section -->
          <div class="destination-section">
            <label class="destination-label">SELECT DESTINATION DOMAIN</label>
            <div class="domain-selection-container">
              <select id="domainSelect" class="destination-select">
                <option value="">Loading domains...</option>
                <!-- Will be populated dynamically with Virtualmin domains -->
              </select>
              <button
                id="refreshDomainsBtn"
                class="action-button icon-button"
                title="Refresh domain list"
              >
                <span class="refresh-icon">‚Üª</span>
              </button>
            </div>
          </div>

          <!-- Domain Analysis Section -->
          <div class="destination-section">
            <div class="domain-analysis-header">
              <label class="destination-label">Domain Analysis</label>
              <button
                id="refreshAnalysisBtn"
                class="refresh-analysis-btn"
                title="Refresh analysis"
              >
                Refresh
              </button>
            </div>
            <div id="domainAnalysisContent" class="domain-analysis-content">
              <div class="empty-section-message">No domain selected</div>
            </div>
          </div>

          <!-- Domain Transfer Preview Section -->
          <div class="destination-section">
            <div class="domain-analysis-header">
              <label class="destination-label">Selected for Transfer</label>
            </div>
            <div class="domain-analysis-content">
              <div id="selectedModulesPreview" class="selected-modules-preview">
                <div class="empty-section-message">
                  No modules selected for transfer
                </div>
              </div>
            </div>
          </div>

          <div
            id="statusMessage"
            class="status-message"
            style="display: none"
          ></div>

          <!-- Add spacer to push fixed bottom to the bottom -->
          <div style="flex-grow: 1"></div>
        </div>

        <!-- Fixed Bottom Section (outside scrollable area) -->
        <div class="destination-fixed-bottom">
          <!-- Transfer Button -->
          <button id="transferButton" class="action-button full-width" disabled>
            Transfer Files
          </button>
        </div>
      </div>

      <!-- Domain Creation Modal -->
      <div id="domainModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Create New Virtualmin Domain</h3>
            <span class="close-modal">&times;</span>
          </div>
          <div class="modal-body">
            <div class="form-field">
              <label class="field-label">Subdomain Name</label>
              <input
                type="text"
                id="newSubdomainInput"
                class="text-input"
                placeholder="e.g., client1"
              />
              <div class="field-hint">
                This will create:
                <span id="newDomainPreview">subdomain.streamnet.live</span>
              </div>
            </div>

            <div class="form-field">
              <label class="field-label">Description</label>
              <input
                type="text"
                id="newDescriptionInput"
                class="text-input"
                placeholder="e.g., Client Website"
              />
            </div>

            <div class="form-field">
              <label class="field-label">PHP Configuration (Optional)</label>
              <div class="php-config-grid">
                <div class="php-mode-select">
                  <label class="field-label small">PHP Mode</label>
                  <select id="phpModeSelect" class="text-input">
                    <option value="fpm" selected>PHP-FPM</option>
                    <option value="cgi">PHP-CGI</option>
                    <option value="mod_php">MOD_PHP</option>
                  </select>
                </div>
                <div class="php-version-select">
                  <label class="field-label small">PHP Version</label>
                  <select id="phpVersionSelect" class="text-input">
                    <option value="8.1" selected>PHP 8.1</option>
                    <option value="8.0">PHP 8.0</option>
                    <option value="7.4">PHP 7.4</option>
                    <option value="7.3">PHP 7.3</option>
                  </select>
                </div>
              </div>
              <div class="configuration-badge notice">
                <span class="badge-icon">‚ÑπÔ∏è</span>
                <span class="badge-text"
                  >PHP configuration will be applied if supported by your
                  Virtualmin installation</span
                >
              </div>
            </div>

            <!-- New Log Output Box -->
            <div class="form-field">
              <label class="field-label">Process Output</label>
              <div id="domainCreationLog" class="console-log-box">
                <div class="log-content"></div>
              </div>
            </div>

            <div class="form-actions">
              <button id="createDomainBtn" class="action-button">
                Create Subdomain
              </button>
              <button id="cancelDomainBtn" class="action-button secondary">
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Full Page Layout (replaces the modal) -->
    <div id="settingsModal" class="settings-fullpage" style="display: none">
      <div class="settings-container">
        <!-- Left sidebar with tabs -->
        <div class="settings-sidebar">
          <div class="settings-header">
            <h2>Settings</h2>
            <button
              id="closeSettingsModalBtn"
              class="close-settings-btn"
              title="Close Settings"
            >
              <span>√ó</span>
            </button>
          </div>

          <div class="settings-nav">
            <button class="settings-nav-item active" data-tab="server">
              <span class="settings-nav-icon">üîå</span>
              <span class="settings-nav-text">Server Config</span>
            </button>
            <button class="settings-nav-item" data-tab="theme">
              <span class="settings-nav-icon">üé®</span>
              <span class="settings-nav-text">Appearance</span>
            </button>
            <button class="settings-nav-item" data-tab="debug">
              <span class="settings-nav-icon">‚öôÔ∏è</span>
              <span class="settings-nav-text">Debug & Testing</span>
            </button>
            <button class="settings-nav-item" data-tab="about">
              <span class="settings-nav-icon">‚ÑπÔ∏è</span>
              <span class="settings-nav-text">About</span>
            </button>
          </div>

          <div
            id="settingsStatusMessage"
            class="status-message"
            style="display: none"
          ></div>

          <div class="settings-footer">
            <div class="settings-app-info">
              <div class="settings-app-version">
                Version: <span id="settingsVersionTag">loading...</span>
              </div>
              <div class="settings-copyright">¬© 2025 cyb3rgh05t</div>
            </div>
          </div>
        </div>

        <!-- Right content area -->
        <div class="settings-content">
          <!-- Configuration Tab-->
          <div class="settings-tab-pane active" id="serverTab">
            <div class="settings-tab-header">
              <h3>Server Configuration</h3>
              <p class="settings-tab-description">
                Configure server connection and domain settings
              </p>
            </div>

            <div class="settings-section">
              <h4 class="settings-section-title">Connection Settings</h4>
              <div class="settings-card">
                <div class="settings-form-field">
                  <label for="configServerHost" class="settings-label"
                    >Server Host</label
                  >
                  <input
                    type="text"
                    id="configServerHost"
                    class="settings-input"
                    placeholder="Enter server hostname or IP"
                  />
                </div>

                <div class="settings-form-field">
                  <label for="configServerUser" class="settings-label"
                    >Username</label
                  >
                  <input
                    type="text"
                    id="configServerUser"
                    class="settings-input"
                    placeholder="Enter server username"
                  />
                </div>

                <div class="settings-form-field">
                  <label for="configServerPassword" class="settings-label"
                    >Password</label
                  >
                  <input
                    type="password"
                    id="configServerPassword"
                    class="settings-input"
                    placeholder="Enter server password"
                  />
                </div>

                <div class="settings-form-field">
                  <label for="configServerPort" class="settings-label"
                    >SSH Port</label
                  >
                  <input
                    type="number"
                    id="configServerPort"
                    class="settings-input"
                    placeholder="22"
                  />
                </div>

                <button
                  id="saveConnectionConfig"
                  class="settings-action-button"
                >
                  Save Connection Settings
                </button>
              </div>
            </div>

            <div class="settings-section">
              <h4 class="settings-section-title">Cloudflare Settings</h4>
              <div class="settings-card">
                <div class="settings-form-field">
                  <label for="configRootDomain" class="settings-label"
                    >Root Domain</label
                  >
                  <input
                    type="text"
                    id="configRootDomain"
                    class="settings-input"
                    placeholder="example.com"
                  />
                </div>

                <div class="settings-form-field">
                  <label for="configCloudflareToken" class="settings-label"
                    >API Token</label
                  >
                  <input
                    type="password"
                    id="configCloudflareToken"
                    class="settings-input"
                    placeholder="Enter Cloudflare API token"
                  />
                </div>

                <div class="settings-form-field">
                  <label for="configCloudflareZoneId" class="settings-label"
                    >Zone ID</label
                  >
                  <input
                    type="text"
                    id="configCloudflareZoneId"
                    class="settings-input"
                    placeholder="Enter Cloudflare Zone ID"
                  />
                </div>

                <div class="settings-form-field">
                  <label for="configIpv4" class="settings-label"
                    >Server IPv4</label
                  >
                  <input
                    type="text"
                    id="configIpv4"
                    class="settings-input"
                    placeholder="Enter server IPv4 address"
                  />
                </div>

                <button
                  id="saveCloudflareConfig"
                  class="settings-action-button"
                >
                  Save Cloudflare Settings
                </button>
              </div>
            </div>

            <div class="settings-section">
              <h4 class="settings-section-title">Paths Configuration</h4>
              <div class="settings-card">
                <div class="settings-form-field">
                  <label for="configBasePath" class="settings-label"
                    >Source Base Path</label
                  >
                  <input
                    type="text"
                    id="configBasePath"
                    class="settings-input"
                    placeholder="/home/"
                  />
                </div>

                <div class="settings-form-field">
                  <label for="configDestPath" class="settings-label"
                    >Destination Base Path</label
                  >
                  <input
                    type="text"
                    id="configDestPath"
                    class="settings-input"
                    placeholder="/home/"
                  />
                </div>

                <button id="savePathsConfig" class="settings-action-button">
                  Save Path Settings
                </button>
              </div>
            </div>
          </div>
          <!-- Theme Tab -->
          <div class="settings-tab-pane" id="themeTab">
            <div class="settings-tab-header">
              <h3>Appearance</h3>
              <p class="settings-tab-description">
                Customize how StreamNet Panels looks
              </p>
            </div>

            <div class="settings-section">
              <h4 class="settings-section-title">Color Theme</h4>
              <div class="settings-card">
                <div class="theme-options">
                  <!-- Dark Theme (Default) -->
                  <div class="theme-option">
                    <input
                      type="radio"
                      id="themeDark"
                      name="theme"
                      value="dark"
                      checked
                    />
                    <label for="themeDark" class="theme-preview dark-preview">
                      <div class="theme-preview-content">
                        <div class="theme-preview-header"></div>
                        <div class="theme-preview-body">
                          <div class="theme-preview-sidebar"></div>
                          <div class="theme-preview-main"></div>
                        </div>
                      </div>
                      <span class="theme-name">Dark</span>
                    </label>
                  </div>

                  <!-- Light Theme -->
                  <div class="theme-option">
                    <input
                      type="radio"
                      id="themeLight"
                      name="theme"
                      value="light"
                    />
                    <label for="themeLight" class="theme-preview light-preview">
                      <div class="theme-preview-content">
                        <div class="theme-preview-header"></div>
                        <div class="theme-preview-body">
                          <div class="theme-preview-sidebar"></div>
                          <div class="theme-preview-main"></div>
                        </div>
                      </div>
                      <span class="theme-name">Light</span>
                    </label>
                  </div>

                  <!-- Nord Theme -->
                  <div class="theme-option">
                    <input
                      type="radio"
                      id="themeNord"
                      name="theme"
                      value="nord"
                    />
                    <label for="themeNord" class="theme-preview nord-preview">
                      <div class="theme-preview-content">
                        <div class="theme-preview-header"></div>
                        <div class="theme-preview-body">
                          <div class="theme-preview-sidebar"></div>
                          <div class="theme-preview-main"></div>
                        </div>
                      </div>
                      <span class="theme-name">Nord</span>
                    </label>
                  </div>

                  <!-- Dracula Theme -->
                  <div class="theme-option">
                    <input
                      type="radio"
                      id="themeDracula"
                      name="theme"
                      value="dracula"
                    />
                    <label
                      for="themeDracula"
                      class="theme-preview dracula-preview"
                    >
                      <div class="theme-preview-content">
                        <div class="theme-preview-header"></div>
                        <div class="theme-preview-body">
                          <div class="theme-preview-sidebar"></div>
                          <div class="theme-preview-main"></div>
                        </div>
                      </div>
                      <span class="theme-name">Dracula</span>
                    </label>
                  </div>

                  <!-- One Dark Theme -->
                  <div class="theme-option">
                    <input
                      type="radio"
                      id="themeOneDark"
                      name="theme"
                      value="onedark"
                    />
                    <label
                      for="themeOneDark"
                      class="theme-preview onedark-preview"
                    >
                      <div class="theme-preview-content">
                        <div class="theme-preview-header"></div>
                        <div class="theme-preview-body">
                          <div class="theme-preview-sidebar"></div>
                          <div class="theme-preview-main"></div>
                        </div>
                      </div>
                      <span class="theme-name">One Dark</span>
                    </label>
                  </div>

                  <!-- Overseerr Theme -->
                  <div class="theme-option">
                    <input
                      type="radio"
                      id="themeOverseerr"
                      name="theme"
                      value="overseerr"
                    />
                    <label
                      for="themeOverseerr"
                      class="theme-preview overseerr-preview"
                    >
                      <div class="theme-preview-content">
                        <div class="theme-preview-header"></div>
                        <div class="theme-preview-body">
                          <div class="theme-preview-sidebar"></div>
                          <div class="theme-preview-main"></div>
                        </div>
                      </div>
                      <span class="theme-name">Overseerr</span>
                    </label>
                  </div>

                  <!-- Space Gray Theme -->
                  <div class="theme-option">
                    <input
                      type="radio"
                      id="themeSpaceGray"
                      name="theme"
                      value="spacegray"
                    />
                    <label
                      for="themeSpaceGray"
                      class="theme-preview spacegray-preview"
                    >
                      <div class="theme-preview-content">
                        <div class="theme-preview-header"></div>
                        <div class="theme-preview-body">
                          <div class="theme-preview-sidebar"></div>
                          <div class="theme-preview-main"></div>
                        </div>
                      </div>
                      <span class="theme-name">Space Gray</span>
                    </label>
                  </div>

                  <!-- Hotline Theme -->
                  <div class="theme-option">
                    <input
                      type="radio"
                      id="themeHotline"
                      name="theme"
                      value="hotline"
                    />
                    <label
                      for="themeHotline"
                      class="theme-preview hotline-preview"
                    >
                      <div class="theme-preview-content">
                        <div class="theme-preview-header"></div>
                        <div class="theme-preview-body">
                          <div class="theme-preview-sidebar"></div>
                          <div class="theme-preview-main"></div>
                        </div>
                      </div>
                      <span class="theme-name">Hotline</span>
                    </label>
                  </div>

                  <!-- Aquamarine Theme -->
                  <div class="theme-option">
                    <input
                      type="radio"
                      id="themeAquamarine"
                      name="theme"
                      value="aquamarine"
                    />
                    <label
                      for="themeAquamarine"
                      class="theme-preview aquamarine-preview"
                    >
                      <div class="theme-preview-content">
                        <div class="theme-preview-header"></div>
                        <div class="theme-preview-body">
                          <div class="theme-preview-sidebar"></div>
                          <div class="theme-preview-main"></div>
                        </div>
                      </div>
                      <span class="theme-name">Aquamarine</span>
                    </label>
                  </div>

                  <!-- Hot Pink Theme -->
                  <div class="theme-option">
                    <input
                      type="radio"
                      id="themeHotPink"
                      name="theme"
                      value="hotpink"
                    />
                    <label
                      for="themeHotPink"
                      class="theme-preview hotpink-preview"
                    >
                      <div class="theme-preview-content">
                        <div class="theme-preview-header"></div>
                        <div class="theme-preview-body">
                          <div class="theme-preview-sidebar"></div>
                          <div class="theme-preview-main"></div>
                        </div>
                      </div>
                      <span class="theme-name">Hot Pink</span>
                    </label>
                  </div>

                  <!-- Maroon Theme -->
                  <div class="theme-option">
                    <input
                      type="radio"
                      id="themeMaroon"
                      name="theme"
                      value="maroon"
                    />
                    <label
                      for="themeMaroon"
                      class="theme-preview maroon-preview"
                    >
                      <div class="theme-preview-content">
                        <div class="theme-preview-header"></div>
                        <div class="theme-preview-body">
                          <div class="theme-preview-sidebar"></div>
                          <div class="theme-preview-main"></div>
                        </div>
                      </div>
                      <span class="theme-name">Maroon</span>
                    </label>
                  </div>

                  <!-- Organizr Theme -->
                  <div class="theme-option">
                    <input
                      type="radio"
                      id="themeOrganizr"
                      name="theme"
                      value="organizr"
                    />
                    <label
                      for="themeOrganizr"
                      class="theme-preview organizr-preview"
                    >
                      <div class="theme-preview-content">
                        <div class="theme-preview-header"></div>
                        <div class="theme-preview-body">
                          <div class="theme-preview-sidebar"></div>
                          <div class="theme-preview-main"></div>
                        </div>
                      </div>
                      <span class="theme-name">Organizr</span>
                    </label>
                  </div>

                  <!-- Plex Theme -->
                  <div class="theme-option">
                    <input
                      type="radio"
                      id="themePlex"
                      name="theme"
                      value="plex"
                    />
                    <label for="themePlex" class="theme-preview plex-preview">
                      <div class="theme-preview-content">
                        <div class="theme-preview-header"></div>
                        <div class="theme-preview-body">
                          <div class="theme-preview-sidebar"></div>
                          <div class="theme-preview-main"></div>
                        </div>
                      </div>
                      <span class="theme-name">Plex</span>
                    </label>
                  </div>
                </div>

                <div class="settings-description">
                  Choose your preferred color theme. Changes apply immediately.
                </div>
              </div>
            </div>

            <div class="settings-section">
              <h4 class="settings-section-title">Interface Density</h4>
              <div class="settings-card">
                <div class="density-options">
                  <div class="density-option">
                    <input
                      type="radio"
                      id="densityComfortable"
                      name="density"
                      value="comfortable"
                      checked
                    />
                    <label for="densityComfortable" class="density-label">
                      <span class="density-preview comfortable-preview"></span>
                      <span class="density-name">Comfortable</span>
                    </label>
                  </div>

                  <div class="density-option">
                    <input
                      type="radio"
                      id="densityCompact"
                      name="density"
                      value="compact"
                    />
                    <label for="densityCompact" class="density-label">
                      <span class="density-preview compact-preview"></span>
                      <span class="density-name">Compact</span>
                    </label>
                  </div>
                </div>

                <div class="settings-description">
                  Adjust the spacing in the user interface to show more content
                  or improve readability.
                </div>
              </div>
            </div>
          </div>

          <!-- Debug Tab -->
          <div class="settings-tab-pane" id="debugTab">
            <div class="settings-tab-header">
              <h3>Debug & Testing</h3>
              <p class="settings-tab-description">
                Troubleshooting tools and connection testing
              </p>
            </div>

            <div class="settings-section">
              <h4 class="settings-section-title">Server Connection</h4>
              <div class="settings-card">
                <div class="connection-test-container">
                  <div class="connection-status-display">
                    <span
                      id="settingsConnectionIndicator"
                      class="status-indicator"
                    ></span>
                    <span id="settingsConnectionText"
                      >Connection status unknown</span
                    >
                  </div>

                  <button
                    id="settingsTestConnectionBtn"
                    class="settings-action-button"
                  >
                    <span class="button-icon">‚Üª</span>
                    Test Connection
                  </button>
                </div>
              </div>
            </div>

            <div class="settings-section">
              <h4 class="settings-section-title">Logging</h4>
              <div class="settings-card">
                <div class="settings-form-field">
                  <label for="settingsLogLevel" class="settings-label"
                    >Log Level</label
                  >
                  <select id="settingsLogLevel" class="settings-select">
                    <option value="0">Debug (Verbose)</option>
                    <option value="1">Info (Normal)</option>
                    <option value="2">Warning</option>
                    <option value="3">Error (Minimal)</option>
                  </select>
                </div>

                <div class="settings-description">
                  Control the level of detail in application logs. Higher levels
                  contain fewer, more important messages.
                </div>

                <div class="debug-tools-container">
                  <button
                    id="settingsOpenDebugBtn"
                    class="settings-action-button"
                  >
                    <span class="button-icon">‚ö†</span>
                    Open Debug Console
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- About Tab -->
          <div class="settings-tab-pane" id="aboutTab">
            <div class="settings-tab-header">
              <h3>About StreamNet Rebrands</h3>
              <p class="settings-tab-description">Information and updates</p>
            </div>

            <div class="settings-section">
              <div class="settings-card about-card">
                <div class="app-logo-container">
                  <div class="app-logo"></div>
                  <h2>Rebrand Panel Tool</h2>
                  <div class="version-tag">
                    Version: <span id="aboutVersionTag">loading...</span>
                  </div>
                </div>

                <div class="app-description">
                  An Electron-based desktop application for streamlined
                  management of IPTV app panels, domain creation, and file
                  deployment.
                </div>

                <div class="update-section">
                  <div
                    id="settingsUpdateStatus"
                    class="settings-status-message"
                  >
                    You're using the latest version
                  </div>

                  <button
                    id="settingsCheckUpdatesBtn"
                    class="settings-action-button"
                  >
                    <span class="button-icon">‚Üª</span>
                    Check for Updates
                  </button>
                </div>

                <div class="about-links">
                  <a href="#" class="about-link" id="openGithubLink">
                    <span class="about-link-icon">üîó</span>
                    GitHub Repository
                  </a>
                  <a href="#" class="about-link" id="openReportIssueLink">
                    <span class="about-link-icon">üêû</span>
                    Report an Issue
                  </a>
                </div>

                <div class="license-info">Released under the MIT License</div>
              </div>
              <!-- Add this to the About tab section, before the about-card div -->
              <div class="settings-section">
                <h4 class="settings-section-title">GitHub Update Settings</h4>
                <div class="settings-card">
                  <div class="settings-form-field">
                    <label for="configGithubToken" class="settings-label"
                      >GitHub API Token</label
                    >
                    <input
                      type="password"
                      id="configGithubToken"
                      class="settings-input"
                      placeholder="Enter GitHub API Token"
                    />
                  </div>

                  <div class="settings-form-field">
                    <label for="configGithubOwner" class="settings-label"
                      >Repository Owner</label
                    >
                    <input
                      type="text"
                      id="configGithubOwner"
                      class="settings-input"
                      placeholder="cyb3rgh05t"
                    />
                  </div>

                  <div class="settings-form-field">
                    <label for="configGithubRepo" class="settings-label"
                      >Repository Name</label
                    >
                    <input
                      type="text"
                      id="configGithubRepo"
                      class="settings-input"
                      placeholder="rebrand-tool"
                    />
                  </div>

                  <div class="settings-description">
                    These settings control how the application checks for
                    updates. A GitHub API token is required to check private
                    repositories and to avoid rate limits.
                  </div>

                  <button id="saveGithubConfig" class="settings-action-button">
                    Save GitHub Settings
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Debug panel modal (hidden by default) -->
    <div id="debugModal" class="modal" style="display: none">
      <div class="modal-content debug-modal-content">
        <div class="modal-header">
          <h3>Debug Console</h3>
          <span class="close-modal" id="closeDebugModalBtn">&times;</span>
        </div>
        <div class="modal-body">
          <div class="debug-controls">
            <div class="form-field">
              <label class="field-label">Log Level</label>
              <select id="logLevelSelect" class="text-input">
                <option value="0">Debug</option>
                <option value="1">Info</option>
                <option value="2">Warning</option>
                <option value="3">Error</option>
              </select>
            </div>
            <div class="debug-buttons">
              <button id="clearLogsBtn" class="action-button secondary">
                Clear Logs
              </button>
              <button id="downloadLogsBtn" class="action-button">
                <span class="button-icon">‚Üì</span>
                Download Logs
              </button>
            </div>
          </div>
          <div id="logOutput" class="log-output"></div>
        </div>
      </div>
    </div>

    <!-- Load the main script as a module -->
    <script type="module" src="src/renderer/script.js"></script>
    <script type="module" src="src/renderer/theme.js"></script>
    <script>
      // Fully self-contained update dialog implementation
      (function () {
        console.log("Initializing theme-aware update dialog system");

        // Create the update dialog when needed
        function createUpdateDialog(updateInfo) {
          // Create the container
          const container = document.createElement("div");
          container.id = "update-dialog-container";

          // Get current theme from document
          let currentTheme = "";
          document.documentElement.classList.forEach((className) => {
            if (className.startsWith("theme-")) {
              currentTheme = className;
            }
          });

          console.log(`Current app theme detected: ${currentTheme || "none"}`);

          // Add theme class to container if detected
          if (currentTheme) {
            container.classList.add(currentTheme);
          }

          // Add ALL styles inline to avoid any external dependencies
          const style = document.createElement("style");
          style.textContent = `
            #update-dialog-container {
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background-color: rgba(0, 0, 0, 0.75);
              display: flex;
              align-items: center;
              justify-content: center;
              z-index: 9999;
              opacity: 0;
              transition: opacity 0.3s ease-in-out;
            }
            
            #update-dialog-container.visible {
              opacity: 1;
            }
            
            .update-dialog {
              background-color: var(--bg-surface, #1e2130);
              color: var(--text-primary, #fff);
              border-radius: 8px;
              width: 450px;
              max-width: 90%;
              box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
              overflow: hidden;
              display: flex;
              flex-direction: column;
              font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            }
            
            .update-dialog-header {
              background-color: var(--primary, #2650d8);
              color: var(--text-on-primary, white);
              padding: 16px;
              display: flex;
              align-items: center;
              position: relative;
              font-weight: 500;
            }
            
            .update-dialog-header .icon {
              margin-right: 12px;
              color: var(--text-on-primary, white);
            }
            
            .update-dialog-header h2 {
              margin: 0;
              font-size: 18px;
              flex-grow: 1;
              font-weight: 500;
            }
            
            .update-dialog-close {
              background: transparent;
              border: none;
              color: rgba(255, 255, 255, 0.7);
              cursor: pointer;
              padding: 4px;
              display: flex;
              align-items: center;
              justify-content: center;
              transition: color 0.2s ease;
            }
            
            .update-dialog-close:hover {
              color: white;
            }
            
            .update-dialog-content {
              padding: 20px;
            }
            
            .update-dialog-message {
              margin: 0 0 16px 0;
              font-size: 16px;
              line-height: 1.5;
            }
            
            .update-dialog-info {
              background-color: var(--bg-surface-light, rgba(0, 0, 0, 0.2));
              border-radius: 6px;
              padding: 16px;
              margin-bottom: 16px;
            }
            
            .update-dialog-version-row {
              display: flex;
              justify-content: space-between;
              margin-bottom: 8px;
            }
            
            .update-dialog-version-row:last-child {
              margin-bottom: 0;
            }
            
            .update-dialog-version-label {
              color: var(--text-secondary, rgba(255, 255, 255, 0.7));
            }
            
            .update-dialog-version-value {
              font-weight: 500;
            }
            
            .update-dialog-version-value.latest {
              color: var(--primary-light, #3e97ff);
            }
            
            .update-dialog-notes-title {
              font-size: 14px;
              margin: 0 0 8px 0;
              color: var(--text-secondary, rgba(255, 255, 255, 0.7));
              font-weight: 500;
            }
            
            .update-dialog-notes {
              background-color: var(--bg-surface-light, rgba(0, 0, 0, 0.2));
              border-radius: 6px;
              padding: 16px;
              margin-bottom: 20px;
              font-size: 14px;
              line-height: 1.6;
              max-height: 200px;
              overflow-y: auto;
              color: var(--text-primary, rgba(255, 255, 255, 0.9));
            }
            
            .update-dialog-notes p {
              margin: 0 0 12px 0;
            }
            
            .update-dialog-notes p:last-child {
              margin-bottom: 0;
            }
            
            .update-dialog-notes a {
              color: var(--primary-light, #3e97ff);
              text-decoration: none;
            }
            
            .update-dialog-notes a:hover {
              text-decoration: underline;
            }
            
            .version-tag {
              display: inline-block;
              background-color: var(--primary, #2650d8);
              color: var(--text-on-primary, white);
              padding: 2px 8px;
              border-radius: 12px;
              font-size: 14px;
              font-weight: bold;
              margin-right: 8px;
              margin-bottom: 8px;
            }
            
            .release-version {
              color: var(--primary, #3e97ff);
              font-weight: 500;
              margin-bottom: 8px;
              display: flex;
              align-items: center;
            }
            
            .update-dialog-actions {
              display: flex;
              justify-content: flex-end;
              gap: 12px;
              margin-bottom: 16px;
            }
            
            .update-dialog-button {
              display: flex;
              align-items: center;
              justify-content: center;
              gap: 8px;
              padding: 10px 16px;
              border-radius: 6px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              transition: background-color 0.2s ease;
              border: none;
            }
            
            .update-dialog-button .icon {
              width: 16px;
              height: 16px;
            }
            
            .update-dialog-button-secondary {
              background-color: var(--bg-button-secondary, rgba(255, 255, 255, 0.1));
              color: var(--text-primary, white);
            }
            
            .update-dialog-button-secondary:hover {
              background-color: var(--bg-button-secondary-hover, rgba(255, 255, 255, 0.15));
            }
            
            .update-dialog-button-primary {
              background-color: var(--primary, #2650d8);
              color: var(--text-on-primary, white);
            }
            
            .update-dialog-button-primary:hover {
              background-color: var(--primary-hover, #3060e8);
            }
            
            .update-dialog-checkbox {
              display: flex;
              align-items: center;
              font-size: 13px;
              color: var(--text-secondary, rgba(255, 255, 255, 0.7));
            }
            
            .update-dialog-checkbox input {
              margin-right: 8px;
            }
      
            /* Theme fallbacks in case CSS variables aren't available */
            .theme-dark .update-dialog {
              background-color: #1e2130;
              color: #fff;
            }
            
            .theme-light .update-dialog {
              background-color: #f5f5f7;
              color: #333;
            }
            
            .theme-light .update-dialog-header {
              background-color: #2650d8;
              color: white;
            }
            
            .theme-light .update-dialog-info,
            .theme-light .update-dialog-notes {
              background-color: rgba(0, 0, 0, 0.05);
              color: #333;
            }
            
            .theme-light .update-dialog-version-label,
            .theme-light .update-dialog-notes-title,
            .theme-light .update-dialog-checkbox {
              color: rgba(0, 0, 0, 0.7);
            }
            
            .theme-light .update-dialog-button-secondary {
              background-color: rgba(0, 0, 0, 0.1);
              color: #333;
            }
            
            .theme-light .update-dialog-button-secondary:hover {
              background-color: rgba(0, 0, 0, 0.15);
            }
          `;

          // Add HTML content with actual version information
          container.innerHTML = `
            <div class="update-dialog">
              <!-- Header -->
              <div class="update-dialog-header">
                <svg
                  class="icon"
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="12" y1="8" x2="12" y2="12"></line>
                  <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
                <h2>Update Available</h2>
                <button id="update-dialog-close" class="update-dialog-close">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
      
              <!-- Content -->
              <div class="update-dialog-content">
                <p class="update-dialog-message">
                  A new version of Rebrands Panels is available:
                  <span class="version" id="update-new-version">v${
                    updateInfo.version
                  }</span>
                </p>
      
                <!-- Version information -->
                <div class="update-dialog-info">
                  <div class="update-dialog-version-row">
                    <span class="update-dialog-version-label">Current version:</span>
                    <span class="update-dialog-version-value" id="update-current-version">v${
                      updateInfo.currentVersion
                    }</span>
                  </div>
                  <div class="update-dialog-version-row">
                    <span class="update-dialog-version-label">Latest version:</span>
                    <span class="update-dialog-version-value latest" id="update-latest-version">v${
                      updateInfo.version
                    }</span>
                  </div>
                </div>
      
                <!-- Release notes with prominent version -->
                <h3 class="update-dialog-notes-title">What's new:</h3>
                <div class="update-dialog-notes" id="update-release-notes">
                  <div class="release-version">
                    <span class="version-tag">v${
                      updateInfo.version
                    }</span> Release Notes
                  </div>
                  ${formatReleaseNotes(
                    updateInfo.releaseNotes,
                    updateInfo.version
                  )}
                </div>
      
                <!-- Action buttons -->
                <div class="update-dialog-actions">
                  <button
                    id="update-dialog-later"
                    class="update-dialog-button update-dialog-button-secondary"
                  >
                    <svg
                      class="icon"
                      xmlns="http://www.w3.org/2000/svg"
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <circle cx="12" cy="12" r="10"></circle>
                      <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    Remind Later
                  </button>
                  <button
                    id="update-dialog-download"
                    class="update-dialog-button update-dialog-button-primary"
                    data-version="${updateInfo.version}"
                    data-url="${updateInfo.downloadUrl || ""}"
                  >
                    <svg
                      class="icon"
                      xmlns="http://www.w3.org/2000/svg"
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                      <polyline points="7 10 12 15 17 10"></polyline>
                      <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Update Now
                  </button>
                </div>
      
                <!-- Don't show again checkbox -->
                <div class="update-dialog-checkbox">
                  <label>
                    <input type="checkbox" id="update-dont-show-again" />
                    Don't show again for this version
                  </label>
                </div>
              </div>
            </div>
          `;

          // Add style to document head
          document.head.appendChild(style);

          // Add the container to the body
          document.body.appendChild(container);

          // Set up event listeners
          setupDialogEvents(container, updateInfo);

          // Show with animation
          setTimeout(() => {
            container.classList.add("visible");
          }, 10);

          console.log(
            `Theme-aware update dialog created for version ${updateInfo.version}`
          );
          return container;
        }

        // Set up events for the dialog
        function setupDialogEvents(container, updateInfo) {
          // Close button
          const closeButton = container.querySelector("#update-dialog-close");
          if (closeButton) {
            closeButton.addEventListener("click", () => {
              hideDialog(container);
            });
          }

          // Later button
          const laterButton = container.querySelector("#update-dialog-later");
          if (laterButton) {
            laterButton.addEventListener("click", () => {
              console.log("User chose to be reminded later");
              hideDialog(container);
            });
          }

          // Download button
          const downloadButton = container.querySelector(
            "#update-dialog-download"
          );
          if (downloadButton) {
            downloadButton.addEventListener("click", () => {
              const url = downloadButton.getAttribute("data-url");
              console.log(`User chose to download update from: ${url}`);

              if (window.streamNetAPI && window.streamNetAPI.openExternalLink) {
                window.streamNetAPI.openExternalLink(url);
              } else {
                window.open(url, "_blank");
              }

              hideDialog(container);
            });
          }

          // Skip version checkbox
          const skipCheckbox = container.querySelector(
            "#update-dont-show-again"
          );
          if (skipCheckbox) {
            skipCheckbox.addEventListener("change", () => {
              if (skipCheckbox.checked) {
                console.log(
                  `User chose to skip future notifications for version ${updateInfo.version}`
                );

                if (
                  window.streamNetAPI &&
                  window.streamNetAPI.skipUpdateVersion
                ) {
                  window.streamNetAPI.skipUpdateVersion(updateInfo.version);
                }
              }
            });
          }

          // Click outside to close
          container.addEventListener("click", (event) => {
            if (event.target === container) {
              hideDialog(container);
            }
          });
        }

        // Hide and remove the dialog
        function hideDialog(container) {
          container.classList.remove("visible");

          // Remove after animation completes
          setTimeout(() => {
            if (container && container.parentNode) {
              container.parentNode.removeChild(container);
            }
          }, 300);
        }

        // Format release notes with simple HTML
        function formatReleaseNotes(notes, version) {
          if (!notes || notes.trim() === "") {
            return `<p>This release includes various improvements and bug fixes.</p>
                    <p>For detailed information, please check the <a href="https://github.com/cyb3rgh05t/rebrand-tool/blob/main/CHANGELOG.md" target="_blank" rel="noopener noreferrer">CHANGELOG.md</a> file.</p>`;
          }

          // Simple markdown-like formatting
          notes = notes
            // Replace Markdown headers (skipping the first one as we've already added it with a tag)
            .replace(/^### (.*?)$/gm, '<p class="release-version">### $1</p>')
            .replace(/^## (.*?)$/gm, '<p class="release-version">## $1</p>')
            .replace(/^# (.*?)$/gm, '<p class="release-version"># $1</p>')

            // Replace links [text](url)
            .replace(
              /\[(.*?)\]\((.*?)\)/g,
              '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>'
            )

            // Replace plain URLs with links
            .replace(
              /(https?:\/\/[^\s]+)/g,
              '<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>'
            )

            // Replace line breaks with paragraph tags
            .replace(/\n\n/g, "</p><p>")
            .replace(/\n/g, "<br>");

          // Wrap in paragraph if needed
          if (!notes.startsWith("<p")) {
            notes = `<p>${notes}</p>`;
          }

          return notes;
        }

        // Show update dialog with the provided info
        function showUpdateDialog(updateInfo) {
          console.log(
            `Showing update dialog for version ${updateInfo.version}`
          );

          // First remove any existing dialog
          const existingDialog = document.getElementById(
            "update-dialog-container"
          );
          if (existingDialog) {
            existingDialog.parentNode.removeChild(existingDialog);
          }

          // Create and show the dialog
          createUpdateDialog(updateInfo);
        }

        // Listen for update notifications via menu actions
        if (window.streamNetAPI && window.streamNetAPI.onMenuAction) {
          window.streamNetAPI.onMenuAction((action, data) => {
            console.log(`Received menu action: ${action}`);

            if (action === "show-update" && data && data.version) {
              console.log(
                `Will show update dialog for version ${data.version}`
              );
              showUpdateDialog(data);
            }
          });

          console.log("Update system listening for menu actions");
        } else {
          console.warn(
            "streamNetAPI.onMenuAction not available - update notifications won't work"
          );
        }

        // Add a test function to the global scope
        window.testUpdateDialog = function () {
          showUpdateDialog({
            version: "2.5.0",
            currentVersion: "2.4.3",
            downloadUrl:
              "https://github.com/cyb3rgh05t/rebrand-tool/releases/tag/v2.5.0",
            releaseNotes:
              '### Added\n\n- Completely redesigned Update Notification System with modern UI\n- New dark-mode optimized update dialog with animated transitions\n- "Don\'t show again for this version" option for update notifications\n\n### Changed\n\n- Improved user preferences system for update notifications\n- Enhanced styling and layout for all notification dialogs',
          });
          return true;
        };

        // Enable using keyboard shortcut Ctrl+U to test the dialog
        document.addEventListener("keydown", (event) => {
          if (event.ctrlKey && event.key === "u") {
            window.testUpdateDialog();
            event.preventDefault();
          }
        });

        console.log(
          "Theme-aware update dialog system ready (Press Ctrl+U to test)"
        );
      })();
    </script>
  </body>
</html>
